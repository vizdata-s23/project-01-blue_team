---
title: "What makes a good chocolate bar?"
subtitle: "STA/ISS 313 - Project 1"
author: "The Blue Team: Ryan Mitchell, Luke Thomas, Jason Yang"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: packages-and-data
#| message: false

library(tidyverse)
library(ggridges)

chocolate <- readr::read_csv("data/chocolate.csv")
```

## Abstract

(1 paragraph): Project abstract.

------------------------------------------------------------------------

## Introduction

For our first project, our team decided to analyze the Chocolate Bar Ratings data set, which comes from the "Flavors of Cacao" database provided by Georgios and Kelsey (two contributors to the TidyTuesday repository). Since chocolate is such a ubiquitous substance in America, our team decided to use this dataset because we were mildly interested in learning more about chocolate and the details about where its produced and how the different ingredients affect its perceived review.

Within the dataset, there are categorical variables such as ingredients and the country of bean origin, and there are numerical variables such as the cocoa percentage and the review score rating of the chocolate. The review scores of the chocolate are on a scale of 1.0 to 5.0 and combine a mixture of both objective and subjective factors. By the end of this project, our team will have used a combination of these variables to create visualizations that reveal more about the intricacies of chocolate production and review.

## Question 1: Where is the best chocolate produced?

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

```{r q1-viz1-data}
q1_viz1 <- chocolate |>
  filter(country_of_bean_origin %in%
           c("Ecuador", "Dominican Republic", "Peru", "Venezuela")) |>
  group_by(country_of_bean_origin, review_date) |>
  mutate(avg_rating = mean(rating)) |>
  select(country_of_bean_origin, review_date, avg_rating) |>
  ungroup() |>
  distinct()
```

```{r q1-viz-plot}
ggplot(q1_viz1, aes(x = review_date,
                    y = avg_rating,
                    color = country_of_bean_origin)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = seq(2006, 2021, 3)) +
  labs(title = "Chocolate Bar Ratings Over Time",
       subtitle = "By Country of Cocoa Bean Origin",
       x = "Review Year",
       y = "Average Rating (From 1 to 4)",
       color = "Country of Bean Origin") +
  theme_minimal()
```

```{r q1-viz2-data}
q1_viz2 <- chocolate |>
  filter(country_of_bean_origin %in%
           c("Ecuador", "Dominican Republic", "Peru", "Venezuela")) |>
  mutate(cocoa_percent = as.numeric(gsub("%", "", cocoa_percent)))
```

```{r q1-viz2-plot}
ggplot(q1_viz2, aes(x = cocoa_percent,
                    y = rating,
                    color = country_of_bean_origin)) +
  facet_wrap(~country_of_bean_origin) +
  geom_point(show.legend = FALSE) +
  geom_smooth(method = "lm") +
  theme_minimal()
```

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

## Question 2: What does the best chocolate contain?

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

For this question, we are interested in exploring some of the main ingredients present in many chocolate bars, and specifically answering the question - PASTE QUESTION HERE. The ingredients variable in the dataset includes abbreviations that indicate the presence of common ingredients in each chocolate bar (B = Beans, S = Sugar, S\* = Sweetener other than white cane or beet sugar, C = Cocoa Butter, V = Vanilla, L = Lecithin, Sa = Salt), as well as a number indicating how many of these ingredients are present. Other relevant variables for this question are the chocolate bar rating, on a scale of 1 to 5, and the date that the chocolate bar was reviewed, a year from 2006 to 2021. This question is interesting and relevant, because it is advantageous to know which ingredients correspond with higher chocolate bar ratings, and it could be fascinating to know if and how these opinions have changed over time. When browsing chocolate bars in the store, this analysis can give someone a better idea of which ones will be the best!

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

```{r q2-viz1-data}
q2_viz1 <- chocolate |>
  mutate(num_ingredients = as.factor(substr(ingredients, 1, 1)),
         sweeteners = if_else(grepl("S\\*", chocolate$ingredients), 1, 0)) |>
  drop_na(ingredients)
```

```{r q2-viz1-plot}
ggplot(q2_viz1, aes(x = rating, y = num_ingredients)) +
  geom_density_ridges() +
  stat_density_ridges(
    geom = "density_ridges_gradient", calc_ecdf = TRUE,
    quantiles = 4, quantile_lines = TRUE
  )
```







```{r}
#| label: ingredient-number-viz

chocolate |>
  drop_na(ingredients) |>
  mutate(num_ingredients = as.factor(substr(ingredients, 1, 1))) |>
  mutate(year_cat = case_when(review_date <= 2010 ~ '2006-2010',
                              review_date <= 2015 ~ '2011-2015',
                              review_date <= 2021 ~ '2016-2021')) |>
  filter(num_ingredients %in% c(2,3,4,5)) |>
  ggplot(aes(x = num_ingredients, y = rating, group = year_cat, fill = year_cat)) +
  geom_bar(position = "dodge", stat = "summary", fun.y = "mean")
```

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.
